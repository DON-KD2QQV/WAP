<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="RadioOperator.net AI Assistant. Get answers to your questions and learn more about radio operations using our advanced AI Assistance.">
    <title>RadioOperator.net AI Assistant</title>
    <link rel="stylesheet" href="css/chatgpt.css">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin="anonymous">
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      processEscapes: true
    },
    "HTML-CSS": {
      preferredFont: "TeX",
      availableFonts: ["STIX", "TeX"],
      linebreaks: { automatic: true }
    },
    showProcessingMessages: false,
    messageStyle: "none"
  });
</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
</head>
<body>
    <section>
    <h2>How Your Data Is Handled</h2>
    <p>When you interact with the AI-powered assistant on this page, here's what happens with the information you provide:</p>
    <ol>
        <li>
            <strong>You Type Your Message:</strong>
            <br>Whatever you type in the chatbox is sent securely to OpenAI's servers.
        </li>
        <li>
            <strong>Processing Your Input:</strong>
            <br>The AI processes your message to generate a response.
        </li>
        <li>
            <strong>Getting a Response:</strong>
            <br>The AI sends the response back to the chat, where you can see it in the conversation.
        </li>
        <li>
            <strong>Temporary Data Use:</strong>
            <br>Your input and the AI's response may be temporarily stored by OpenAI to help improve their service, but this data is generally anonymized.
        </li>
        <li>
            <strong>Data Security:</strong>
            <br>Your data is transmitted securely, and OpenAI takes steps to protect your information.
        </li>
        <li>
            <strong>No Memory Between Sessions:</strong>
            <br>The AI does not remember any previous conversations once the session ends. Each chat is treated as a new interaction.
        </li>
    </ol>
</section>

<section>
    <h2>Privacy and Security</h2>
    <p>We value your privacy. Your data is used solely to generate responses and is protected through encryption and other security measures. For more detailed information, you can review <a href="https://openai.com/privacy" target="_blank" rel="noopener">OpenAI's Privacy Policy</a>.</p>
</section>
    <div id="page-container">
        <div id="content-wrap">
            <div id="chat-container">
                <header>
                    <h1>RadioOperator.net AI Assistant</h1>
                </header>
                <div id="chat-box" aria-live="polite" role="log"></div>
                <div id="input-box">
                    <input type="text" id="user-input" placeholder="Type your message here..." onkeydown="handleKeyDown(event)" spellcheck="true" autocomplete="on">
                    <button id="send-button" onclick="sendMessage()">Send</button>
                    <button id="clear-button" onclick="clearChat()">Clear</button>
                </div>
            </div>
            

        <div class="centered-dropdown">
            <label for="bottom_navigation" class="sr-only">Website Navigation</label> <!-- Accessible label -->
            <select id="bottom_navigation">
                <option value="" disabled selected>Website Navigation</option>
                <option value="https://www.radiooperator.net">HomePage</option>
                <option value="https://www.radiooperator.net/forums">Bulletin Board (Forum)</option>
                <option value="audioanalyzer.html">Audio Signal Analyzer</option>
                <option value="chatgpt.html">RadioOperator.net AI Assistant</option>
                <option value="binaryclock.html">Binary Clock</option>
                <option value="https://www.radiooperator.net/cgi-bin/weather.cgi">Weather Alert Pro</option>
                <option value="amateur-radio-resources-courses.html">Amateur Radio Resources and Courses</option>
            </select>
        </div>
        <footer>
            <p>&copy; 2024 RadioOperator.net  
                <a href="terms-of-service.html" target="_blank">Terms of Service</a> | 
                <a href="privacy.html" target="_blank">Privacy Policy</a> | 
                <a href="mailto:support@radiooperator.net">Contact Us</a>
            </p>
        </footer>
        
        </div>
    </div>
    <script>
    let conversation = [
    {
        role: 'system',
        content: `
        You are ChatGPT on the RadioOperator.net website. Provide expert assistance on radio communications, amateur radio, radio repairs, radio technology, code snippets and technical topics.

        For calculations:
        - By default, display fractions in a simple, straightforward format like "2/3 + 1/4 = 11/12".
        - If LaTeX formatting is requested, use it to present fractions and equations, but also offer a plain text version in case LaTeX rendering fails.
        - Include the formula, substituted values, and final result in both formats when appropriate.

        For circuit diagrams:
        - Use a text-based format with clear labeling (e.g., ASCII art).

        When outputting code snippets in any programming language (HTML, CSS, JavaScript, Python, etc.):
        - Always output the code as plain text, not rendered content.
        - Use triple backticks (\`\`\`) to enclose the code and specify the language (e.g., \`\`\`html\`\`\`).
        - Escape any special HTML characters to prevent the browser from rendering the code. For example, use \`&lt;\` instead of \`<\`, \`&gt;\` instead of \`>\`.
        - Ensure that the code can be easily copied and pasted by the user.

        Example for HTML output:
        
        \`\`\`html
        &lt;!DOCTYPE html&gt;
        &lt;html lang="en"&gt;
        &lt;head&gt;
            &lt;meta charset="UTF-8"&gt;
            &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
            &lt;title&gt;Example Page&lt;/title&gt;
        &lt;/head&gt;
        &lt;body&gt;
            &lt;h1&gt;Hello, World!&lt;/h1&gt;
        &lt;/body&gt;
        &lt;/html&gt;
        \`\`\`

        Ensure that all code outputs follow this format strictly.
        `
    },
    { role: 'assistant', content: 'Welcome to RadioOperator.net! How can I assist you today?' }
];





    document.addEventListener("DOMContentLoaded", function() {
        displayMessage('chatgpt', 'Welcome to RadioOperator.net! How can I assist you today?');
    });

    async function sendMessage() {
        var userInput = document.getElementById('user-input');
        var message = userInput.value.trim();
        if (message === '') return;

        displayMessage('user', message);
        conversation.push({ role: 'user', content: message });

        // Get ChatGPT response
        var response = await getChatGPTResponse(conversation);
        displayMessage('chatgpt', response);
        conversation.push({ role: 'assistant', content: response });
        userInput.value = '';
    }
    async function getChatGPTResponse(conversation) {
        const proxyUrl = '/proxy.php'; // Update with your proxy.php URL

        const requestData = {
            model: 'gpt-4o-mini', // Ensure this model name is correct and supported
            messages: conversation,
            max_tokens: 1000,
            temperature: 0.3, // More deterministic responses
            frequency_penalty: 0.0, // No penalty for frequency
            top_p: 1.0, // Standard setting for diversity
            presence_penalty: 0.0, // No penalty for presence
            stop: null // Optional stopping points
        };

        try {
            const response = await fetch(proxyUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(requestData)
            });

            if (!response.ok) {
                const errorBody = await response.text(); // Get the error body for more details
                console.error('ChatGPT API Error Body:', errorBody);
                throw new Error(`Error fetching ChatGPT response: ${response.statusText}`);
            }

            const responseData = await response.json();

            // Debugging: Log the entire responseData to see its structure
            console.log('Raw ChatGPT API Response:', responseData);

            if (!responseData.choices || !Array.isArray(responseData.choices) || responseData.choices.length === 0 || !responseData.choices[0].message || !responseData.choices[0].message.content) {
                console.error('Invalid ChatGPT API Response Structure:', responseData);
                throw new Error('Invalid response from ChatGPT API: choices array is empty or not defined.');
            }

            return responseData.choices[0].message.content.trim();

        } catch (error) {
            console.error('Error fetching ChatGPT response:', error.message);
            return 'Error: Unable to fetch response from ChatGPT';
        }
    }

    function displayMessage(sender, message) {
    var chatBox = document.getElementById('chat-box');
    var messageElement = document.createElement('div');
    messageElement.classList.add('message');

    if (sender === 'user') {
        messageElement.classList.add('user-message');
        messageElement.textContent = message;
    } else {
        messageElement.classList.add('chatgpt-message');
        
        const escapedContent = message
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
            .replace(/"/g, '&quot;')
            .replace(/'/g, '&#039;');

        if (escapedContent.includes("```")) {
            const formattedCode = escapedContent
                .replace(/```(html|css|javascript|python)?/g, '')
                .replace(/```/g, '')
                .trim();

            const codeBlocks = formattedCode.split(/\n{2,}/g); // Split into code blocks
            codeBlocks.forEach(block => {
                var codeElement = document.createElement('pre');
                codeElement.style.whiteSpace = 'pre-wrap';
                codeElement.innerHTML = `<code>${block}</code>`;
                messageElement.appendChild(codeElement);
            });
        } else {
            messageElement.innerHTML = escapedContent.replace(/\n/g, '<br>');
        }

        if (window.MathJax) {
            MathJax.Hub.Queue(["Typeset", MathJax.Hub, messageElement]);
        }
    }

    chatBox.appendChild(messageElement);
    chatBox.scrollTop = chatBox.scrollHeight;
}




    function clearChat() {
        var chatBox = document.getElementById('chat-box');
        chatBox.innerHTML = '';
        conversation = [
    {
        role: 'system',
        content: `
        You are ChatGPT on the RadioOperator.net website. Provide expert assistance on radio communications, amateur radio, radio repairs, radio technology, code snippets and technical topics.

        For calculations:
        - By default, display fractions in a simple, straightforward format like "2/3 + 1/4 = 11/12".
        - If LaTeX formatting is requested, use it to present fractions and equations, but also offer a plain text version in case LaTeX rendering fails.
        - Include the formula, substituted values, and final result in both formats when appropriate.

        For circuit diagrams:
        - Use a text-based format with clear labeling (e.g., ASCII art).
        

        When outputting code snippets in any programming language (HTML, CSS, JavaScript, Python, etc.):
        - Always output the code as plain text, not rendered content.
        - Use triple backticks (\`\`\`) to enclose the code and specify the language (e.g., \`\`\`html\`\`\`).
        - Escape any special HTML characters to prevent the browser from rendering the code. For example, use \`&lt;\` instead of \`<\`, \`&gt;\` instead of \`>\`.
        - Ensure that the code can be easily copied and pasted by the user.

        Example for HTML output:
        
        \`\`\`html
        &lt;!DOCTYPE html&gt;
        &lt;html lang="en"&gt;
        &lt;head&gt;
            &lt;meta charset="UTF-8"&gt;
            &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
            &lt;title&gt;Example Page&lt;/title&gt;
        &lt;/head&gt;
        &lt;body&gt;
            &lt;h1&gt;Hello, World!&lt;/h1&gt;
        &lt;/body&gt;
        &lt;/html&gt;
        \`\`\`

        Ensure that all code outputs follow this format strictly.
        `
    },
    { role: 'assistant', content: 'Welcome to RadioOperator.net! How can I assist you today?' }
];




        displayMessage('chatgpt', 'Welcome to RadioOperator.net! How can I assist you today?');
    }

    function handleKeyDown(event) {
        if (event.key === 'Enter') {
            event.preventDefault(); // Prevent form submission
            sendMessage();
        }
    }
    </script>
</body>
</html>
